#!/bin/bash
# finn income - Current vs expected income

CHECKCHECK_LATEST=$(find ~/Documents/Code/checkcheck/data -name "results-*.json" 2>/dev/null | sort | tail -1)

if [ -z "$CHECKCHECK_LATEST" ]; then
  echo "üí∞ Income"
  echo "Current:"
  echo "  Finn: \$1050/mo"
  echo "  CheckCheck: data not found"
  echo ""
  echo "Future (PWD approved ~May 2026):"
  echo "  Expected: \$1,483.50/mo (+\$423.50)"
  exit 0
fi

CHECKCHECK_INCOME=$(cat "$CHECKCHECK_LATEST" | jq -r '.sections["Payment Info"].tableData[] | select(contains("Amount:")) | split(":")[1] | split("|")[0] | gsub("[^0-9.]"; "")' 2>/dev/null | head -1)
[ -z "$CHECKCHECK_INCOME" ] && CHECKCHECK_INCOME=1060

FINN_INCOME=1050  # From finn data

echo "üí∞ Income"
echo "Current:"
echo "  Finn: \$$FINN_INCOME/mo"
echo "  CheckCheck: \$$CHECKCHECK_INCOME/mo"

if [ "$FINN_INCOME" != "${CHECKCHECK_INCOME%.*}" ]; then
  DIFF=$(echo "$CHECKCHECK_INCOME - $FINN_INCOME" | bc)
  echo "  ‚ö†Ô∏è  mismatch detected (\$$DIFF difference)"
fi

echo ""
echo "Future (PWD approved ~May 2026):"
FUTURE=$(echo "$CHECKCHECK_INCOME + 423.50" | bc)
echo "  Expected: \$$FUTURE/mo (+\$423.50)"
