#!/bin/bash
# finn surplus - Show monthly surplus with PWD projection

CHECKCHECK_LATEST=$(find ~/Documents/Code/checkcheck/data -name "results-*.json" 2>/dev/null | sort | tail -1)

if [ -z "$CHECKCHECK_LATEST" ]; then
  echo "âš ï¸  CheckCheck data not found, using defaults"
  CURRENT_INCOME=1060
else
  CURRENT_INCOME=$(cat "$CHECKCHECK_LATEST" | jq -r '.sections["Payment Info"].tableData[] | select(contains("Amount:")) | split(":")[1] | split("|")[0] | gsub("[^0-9.]"; "")' 2>/dev/null | head -1)
  [ -z "$CURRENT_INCOME" ] && CURRENT_INCOME=1060
fi

EXPENSES=557  # From previous finn data
CURRENT_SURPLUS=$(echo "$CURRENT_INCOME - $EXPENSES" | bc)

PWD_INCREASE=423.50
FUTURE_INCOME=$(echo "$CURRENT_INCOME + $PWD_INCREASE" | bc)
FUTURE_SURPLUS=$(echo "$CURRENT_SURPLUS + $PWD_INCREASE" | bc)

echo "ðŸ“Š Monthly Surplus"
echo "Current: +\$$CURRENT_SURPLUS/mo"
echo "With PWD (~May 2026): +\$$FUTURE_SURPLUS/mo"
echo "  (Income \$$CURRENT_INCOME â†’ \$$FUTURE_INCOME)"
